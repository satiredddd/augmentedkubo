<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Test - Kubo PH</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <!-- AR.js for simple AR -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body { 
        margin: 0; 
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      
      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        z-index: 9999;
        text-align: center;
      }
      
      #instructions {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        font-size: 14px;
        max-width: 80%;
        text-align: center;
        z-index: 1000;
      }

      .spinner {
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      #debug {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: lime;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        z-index: 1000;
        max-width: 90%;
      }
    </style>
  </head>

  <body>
    <!-- Loading Screen -->
    <div id="loading">
      <div class="spinner"></div>
      <div>Initializing AR...</div>
    </div>

    <!-- Instructions -->
    <div id="instructions">
      ðŸ“± Point camera at flat surface<br>
      ðŸ‘† Tap to place furniture
    </div>

    <!-- Debug Info -->
    <div id="debug">Status: Starting...</div>

    <!-- AR Scene -->
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene">

      <!-- Camera -->
      <a-camera gps-camera rotation-reader look-controls-enabled="false"></a-camera>

      <!-- Simple 3D Chair that appears when you tap -->
      <a-entity id="chair" visible="false">
        <!-- Chair Seat -->
        <a-box 
          position="0 0.5 0" 
          width="0.5" 
          height="0.1" 
          depth="0.5"
          color="#8B4513"
          shadow>
        </a-box>
        
        <!-- Chair Back -->
        <a-box 
          position="0 0.8 -0.2" 
          width="0.5" 
          height="0.5" 
          depth="0.1"
          color="#8B4513"
          shadow>
        </a-box>
        
        <!-- Legs -->
        <a-cylinder position="-0.2 0.25 -0.2" radius="0.03" height="0.5" color="#654321"></a-cylinder>
        <a-cylinder position="0.2 0.25 -0.2" radius="0.03" height="0.5" color="#654321"></a-cylinder>
        <a-cylinder position="-0.2 0.25 0.2" radius="0.03" height="0.5" color="#654321"></a-cylinder>
        <a-cylinder position="0.2 0.25 0.2" radius="0.03" height="0.5" color="#654321"></a-cylinder>

        <!-- Floating indicator -->
        <a-ring
          position="0 0 0"
          radius-inner="0.3"
          radius-outer="0.35"
          color="#4CAF50"
          rotation="-90 0 0"
          animation="property: rotation; to: -90 360 0; loop: true; dur: 3000; easing: linear">
        </a-ring>
      </a-entity>

    </a-scene>

    <script>
      const debug = document.getElementById('debug');
      const loading = document.getElementById('loading');
      const instructions = document.getElementById('instructions');
      const chair = document.getElementById('chair');
      const scene = document.getElementById('scene');
      
      let isPlaced = false;
      let startTime = Date.now();

      function log(msg) {
        console.log(msg);
        debug.innerHTML = `Status: ${msg}<br>Time: ${((Date.now() - startTime) / 1000).toFixed(1)}s`;
      }

      // Hide loading after 3 seconds
      setTimeout(() => {
        loading.style.display = 'none';
        log('AR Ready - Tap to place chair');
      }, 3000);

      // Place chair on tap
      document.addEventListener('click', (e) => {
        if (!isPlaced) {
          // Get camera position
          const camera = document.querySelector('a-camera');
          const cameraPos = camera.getAttribute('position');
          
          // Place chair 1.5 meters in front of camera
          chair.setAttribute('position', {
            x: cameraPos.x,
            y: 0,
            z: cameraPos.z - 1.5
          });
          
          chair.setAttribute('visible', 'true');
          isPlaced = true;
          
          instructions.innerHTML = 'âœ… Chair placed!<br>ðŸ‘† Tap again to move it';
          log('Chair placed successfully');
          
          // Add scale animation
          chair.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 500; easing: easeOutElastic');
        } else {
          // Move chair to new position
          const camera = document.querySelector('a-camera');
          const cameraPos = camera.getAttribute('position');
          
          chair.setAttribute('position', {
            x: cameraPos.x,
            y: 0,
            z: cameraPos.z - 1.5
          });
          
          log('Chair moved');
        }
      });

      // Check for camera access
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          log('Camera access granted âœ“');
          stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => {
          log('Camera error: ' + err.message);
          debug.style.background = 'rgba(255,0,0,0.7)';
        });

      // Scene loaded
      scene.addEventListener('loaded', () => {
        log('AR Scene loaded âœ“');
      });

      // Log errors
      window.addEventListener('error', (e) => {
        log('Error: ' + e.message);
        debug.style.background = 'rgba(255,0,0,0.7)';
      });
    </script>
  </body>
</html>