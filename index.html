<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Camera Test</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: Arial, sans-serif;
        background: #000;
        color: white;
        overflow: hidden;
      }
      
      #camera-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      
      #camera {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
      }
      
      #status {
        position: fixed;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        padding: 15px;
        border-radius: 10px;
        font-size: 14px;
        z-index: 100;
      }
      
      #chair {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 100px;
        z-index: 50;
        display: none;
        animation: bounce 0.5s ease-out;
      }
      
      @keyframes bounce {
        0% { transform: translate(-50%, -50%) scale(0); }
        50% { transform: translate(-50%, -50%) scale(1.2); }
        100% { transform: translate(-50%, -50%) scale(1); }
      }
      
      #start-btn {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: #4CAF50;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        z-index: 100;
      }
      
      #start-btn:active {
        background: #45a049;
      }
      
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        vertical-align: middle;
        margin-right: 10px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    
    <div id="status">
      <div class="spinner"></div>
      <span id="status-text">Initializing...</span>
    </div>
    
    <div id="camera-container">
      <video id="camera" autoplay playsinline></video>
    </div>
    
    <div id="overlay">
      <div id="chair">ü™ë</div>
    </div>
    
    <button id="start-btn" onclick="placeChair()">üìç Place Chair</button>
    
    <script>
      const video = document.getElementById('camera');
      const status = document.getElementById('status-text');
      const statusBox = document.getElementById('status');
      const chair = document.getElementById('chair');
      const btn = document.getElementById('start-btn');
      
      let chairPlaced = false;
      
      function updateStatus(msg, isError = false) {
        console.log(msg);
        status.textContent = msg;
        statusBox.style.background = isError ? 'rgba(255,0,0,0.8)' : 'rgba(0,0,0,0.8)';
        
        if (!isError) {
          // Hide status after 3 seconds if success
          setTimeout(() => {
            statusBox.style.display = 'none';
          }, 3000);
        }
      }
      
      function placeChair() {
        if (!chairPlaced) {
          chair.style.display = 'block';
          chairPlaced = true;
          btn.textContent = '‚úÖ Chair Placed!';
          btn.style.background = '#2196F3';
          
          setTimeout(() => {
            btn.textContent = 'üìç Move Chair';
            btn.style.background = '#4CAF50';
          }, 2000);
        } else {
          // Re-animate
          chair.style.animation = 'none';
          setTimeout(() => {
            chair.style.animation = 'bounce 0.5s ease-out';
          }, 10);
        }
      }
      
      // Start camera
      async function startCamera() {
        try {
          updateStatus('Requesting camera access...');
          
          // Check if getUserMedia is available
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            throw new Error('Camera API not supported in this browser');
          }
          
          // Request camera with environment (back) camera
          const constraints = {
            video: {
              facingMode: { ideal: 'environment' },
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          };
          
          updateStatus('Opening camera...');
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          
          video.srcObject = stream;
          
          video.onloadedmetadata = () => {
            updateStatus('‚úÖ Camera ready! Tap button to place chair');
          };
          
        } catch (err) {
          console.error('Camera error:', err);
          updateStatus(`‚ùå Camera Error: ${err.message}`, true);
          
          // Show helpful message
          setTimeout(() => {
            if (confirm('Camera access denied. Would you like to see instructions?')) {
              alert('Please:\n1. Go to your device Settings\n2. Find this app\n3. Enable Camera permission\n4. Restart the app');
            }
          }, 1000);
        }
      }
      
      // Start on load
      window.addEventListener('load', () => {
        setTimeout(startCamera, 500);
      });
      
      // Handle page visibility
      document.addEventListener('visibilitychange', () => {
        if (document.hidden && video.srcObject) {
          video.srcObject.getTracks().forEach(track => track.stop());
        } else if (!document.hidden) {
          startCamera();
        }
      });
      
      // Log device info
      console.log('User Agent:', navigator.userAgent);
      console.log('Platform:', navigator.platform);
      console.log('MediaDevices available:', !!navigator.mediaDevices);
    </script>
    
  </body>
</html>